# Node.js with Vue
# Build a Node.js project that uses Vue.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
- master

stages:
- stage: DEV
  jobs:
  - job: build
    pool:
      vmImage: ubuntu-latest
    displayName: 'Build and Deploy to PROD'
    steps:
        - task: Docker@2
          displayName: 'Build Docker Image'
          inputs:
            repository: 'vue-app'
            command: 'build'
            Dockerfile: 'Dockerfile'
            tags: 'latest'
        - task: ECRPushImage@1
          displayName:  'Push Docker Image to ECR'
          inputs:
            awsCredentials: 'AWS'
            regionName: 'us-east-1'
            imageSource: 'imagename'
            sourceImageName: 'vue-app'
            repositoryName: 'vue-app'
        - task: AWSCLI@1
          displayName: 'Restart ECS service'
          inputs:
            awsCredentials: 'AWS'
            regionName: 'us-east-1'
            awsCommand: 'ecs'
            awsSubCommand: 'update-service'
            awsArguments: '--cluster dev-cluster --service deployment-service --force-new-deployment'
- stage: PROD
  jobs:
  - job: build
    displayName: 'Build and Deploy to PROD'
    pool:
      vmImage: ubuntu-latest
    steps:
      - script: echo Hello world